<VirtualHost *:{{ ms_rest_port }}>
    ServerName {{ ms_rest_host }}

    LoadModule wsgi_module {{ mod_wsgi_system_module }}
    WSGIDaemonProcess mscan_rest user={{ ms_user }} group=root threads=5 python-home={{ multiscanner_venv }} python-path={{ multiscanner_install_prefix }}/multiscanner/utils
    WSGIScriptAlias / {{ multiscanner_install_prefix }}/multiscanner/utils/mscan_rest.wsgi

    Header always set Access-Control-Allow-Origin "http://{{ groups.webserver[0] }}"
    Header always set Access-Control-Max-Age "1000"
    Header always set Access-Control-Allow-Headers "X-Requested-With, Content-Type, Origin, Authorization, Accept, Client-Security-Token, Accept-Encoding"
    Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT"

    <Directory {{ multiscanner_install_prefix }}/multiscanner>
        WSGIProcessGroup mscan_rest
        WSGIScriptReloading On
        WSGIApplicationGroup %{GLOBAL}
        Order deny,allow
        Allow from all
        AllowOverride All
        Require all granted

        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} OPTIONS
        RewriteRule ^(.*)$ $1 [R=200,L]
    </Directory>
    ErrorLog {{ mscan_rest_log_dir }}/error.log
    LogLevel debug
    CustomLog {{ mscan_rest_log_dir }}/access.log combined
</VirtualHost>